(self.webpackChunkAcurastExample=self.webpackChunkAcurastExample||[]).push([[997],{149:function(e,t,n){"use strict";var r=n(8287).hp,s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AcurastClient=void 0;const o=n(3339),i=n(7535);t.AcurastClient=class{get transport(){if(void 0===this._transport)throw new Error("AcurastClient has not started yet");return this._transport}constructor(e,t=15e3,n=100,r=!1){this.urls=e,this.connectionTimeoutMillis=t,this.maxPayloadLogLength=n,this.enableLogging=r,this.messageListenerBuffer=[]}start(e){return s(this,void 0,void 0,(function*(){if(void 0!==this._transport)return;const t=new o.WebSocketTransportClient(this.urls,this.connectionTimeoutMillis,this.maxPayloadLogLength,this.enableLogging);this.messageListenerBuffer.forEach((e=>{t.onMessage(e)})),this.messageListenerBuffer=[],yield t.connect({secretKey:(0,i.uint8ArrayFrom)(e.secretKey),publicKey:(0,i.uint8ArrayFrom)(e.publicKey)}),this._transport=t}))}onMessage(e){void 0===this._transport?this.messageListenerBuffer.push(e):this._transport.onMessage(e)}send(e,t){return s(this,void 0,void 0,(function*(){yield this.transport.send((0,i.uint8ArrayFrom)(e),(0,i.uint8ArrayFrom)(t))}))}close(){var e;return s(this,void 0,void 0,(function*(){yield null===(e=this._transport)||void 0===e?void 0:e.close(),this._transport=void 0}))}idFromPublicKey(e){const t=this.transport.idFromPublicKey((0,i.uint8ArrayFrom)(e));return r.from(t).toString("hex")}}},2218:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AcurastClient=void 0;var r=n(149);Object.defineProperty(t,"AcurastClient",{enumerable:!0,get:function(){return r.AcurastClient}})},7535:(e,t,n)=>{"use strict";var r=n(8287).hp;function s(e){return/^(0x)?[0-9a-fA-F]*$/.test(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isHex=t.uint8ArrayFrom=void 0,t.uint8ArrayFrom=function(e){return"string"==typeof e?s(e)?r.from(e.replace(/^0x/,""),"hex"):r.from(e,"utf-8"):e},t.isHex=s},3339:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WebSocketTransportClient:()=>T,createAcceptedMessage:()=>u,createChallengeMessage:()=>c,createInitMessage:()=>i,createPayloadMessage:()=>l,createResponseMessage:()=>a,forgeMessage:()=>y,log:()=>g,parseMessage:()=>d,verifyDifficulty:()=>v});var r=n(8287).hp;const s=new Uint8Array(16);function o(e){if(0!==e.length)return e.at(0)>>4}function i(e,t=s,n){return{version:1,type:"init",sender:e,recipient:t,permissions:n}}function c(e,t,n,r=s){return{version:1,type:"challenge",sender:r,recipient:e,challenge:t,difficulty:n}}function a(e,t,n,r,o,i=s){return{version:1,type:"response",sender:e,recipient:i,challenge:t,publicKey:n,nonce:r,signature:o}}function u(e,t=s){return{version:1,type:"accepted",sender:t,recipient:e}}function l(e,t,n){return{version:1,type:"payload",sender:e,recipient:t,payload:n}}const h={init:0,challenge:1,response:2,accepted:3,payload:4};function d(e){const t=o(e);if(void 0!==t)return 1===t?function(e){if(!function(e){return 1===o(e)}(e))return;const t=function(e){if(0!==e.length)return 15&e.at(0)}(e);if(void 0===t)return;const n=e.subarray(1,17),r=e.subarray(17,33),s=e.subarray(33);switch(t){case h.init:return function(e,t){return i(e,t)}(n,r);case h.challenge:return function(e,t,n){const r=n.subarray(0,16);return c(t,n.subarray(16),r,e)}(n,r,s);case h.response:return function(e,t,n){return a(e,n.subarray(0,16),n.subarray(16,49),n.subarray(49,65),n.subarray(65),t)}(n,r,s);case h.accepted:return function(e,t){return u(t,e)}(n,r);case h.payload:return function(e,t,n){return l(e,t,n)}(n,r,s);default:return}}(e):void 0}var f=n(8287).hp;function y(e){if(1===e.version)return function(e){const t=function(e,t,n,s){const o=e<<4,i=r.alloc(1);return i.writeInt8(o|t),r.concat([i,n,s])}(e.version,h[e.type],e.sender,e.recipient),n=function(e){switch(e.type){case"init":case"accepted":return f.alloc(0);case"challenge":return function(e){return f.concat([e.difficulty,e.challenge])}(e);case"response":return function(e){return f.concat([e.challenge,e.publicKey,e.nonce,e.signature])}(e);case"payload":return function(e){return f.from(e.payload)}(e)}}(e);return f.concat([t,n])}(e)}var p=n(8287).hp;function g(e,...t){t.length>0?(console.groupCollapsed(e),console.log(...function(e){return JSON.parse(JSON.stringify(e,(function(e,t){return p.isBuffer(this[e])?this[e].toString("hex"):this[e]instanceof ArrayBuffer?p.from(this[e]).toString("hex"):ArrayBuffer.isView(this[e])?p.from(this[e].buffer).toString("hex"):t})))}(t)),console.groupEnd()):console.log(e)}function v(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n+=1)if(e[n]>t[n])return!1;return!0}n(8287).hp;class m{send(e){return t=this,n=void 0,s=function*(){yield this.sendRaw(y(e))},new((r=void 0)||(r=Promise))((function(e,o){function i(e){try{a(s.next(e))}catch(e){o(e)}}function c(e){try{a(s.throw(e))}catch(e){o(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}a((s=s.apply(t,n||[])).next())}));var t,n,r,s}onMessage(e){this.onRawMessage((t=>{const n=d(t);void 0!==n&&e(n)}))}}var w=n(7052),b=n(204),A=n(6729),C=n(8287).hp;class P{getRandomValues(e){return(0,w.po)(e)}sha256(e){const t=new b.aD;return t.update(e),t.digest()}compressP256PublicKey(e){const t=new A.ec("p256").keyFromPublic(e).getPublic(!0,"hex");return C.from(t,"hex")}signP256(e,t){const n=new A.ec("p256").keyFromPrivate(t).sign(e);return C.concat([n.r.toArrayLike(C,"be",32),n.s.toArrayLike(C,"be",32)])}senderId(e){return 16===e.length?e:this.sha256(e).slice(0,16)}}var L=n(8287).hp,x=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((r=r.apply(e,t||[])).next())}))};class M{constructor(e,t=new P){this.sender=e,this.crypto=t}init(){return x(this,void 0,void 0,(function*(){return{type:"send",message:i(this.sender)}}))}processMessage(e,t){return x(this,void 0,void 0,(function*(){if(1===e.version)switch(e.type){case"challenge":return yield this.onChallenge(e,t);case"accepted":return this.onAccepted(e);case"payload":return this.onPayload(e);default:return}}))}prepareMessage(e,t){return x(this,void 0,void 0,(function*(){return l(this.sender,e,t)}))}onChallenge(e,t){return x(this,void 0,void 0,(function*(){const n=new Uint8Array(16),r=L.concat([e.challenge,t.publicKey,n]),s=this.crypto.signP256(this.crypto.sha256(r),t.secretKey);return{type:"send",message:a(this.sender,e.challenge,t.publicKey,n,s)}}))}onAccepted(e){return{type:"connected"}}onPayload(e){return{type:"notify",message:{sender:e.sender,recipient:e.recipient,payload:e.payload}}}}class S{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}var _=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((r=r.apply(e,t||[])).next())}))};class R{constructor(e,t,n,r=new P,s=100,o=!1){this.urls=e,this.connectionTimeoutMillis=t,this.session=n,this.crypto=r,this.maxPayloadLogLength=s,this.enableLogging=o,this.version=1,this.isConnected=new S,this.messageProcessors={},this.messageListeners=[]}tryConnectingToUrls(){return _(this,void 0,void 0,(function*(){let e=null;if(this.lastSelectedURL)try{return yield this.session.open(this.lastSelectedURL),void this.log(`Connected to: ${this.lastSelectedURL}`)}catch(t){this.log(`Failed to connect to: ${this.lastSelectedURL}`),e=t}const t=this.urls.filter((e=>e!==this.lastSelectedURL));for(const n of t)try{return this.lastSelectedURL=n,yield this.session.open(n),void this.log(`Connected to ${n}`)}catch(t){this.log(`Failed to connect to ${n}`),e=t}throw e?new Error(`All connections failed: ${e.message}`):new Error("No URL provided.")}))}connect(e){return _(this,void 0,void 0,(function*(){yield this.tryConnectingToUrls(),this.log("Session opened");const t={secretKey:e.secretKey,publicKey:this.crypto.compressP256PublicKey(e.publicKey)},n=this.crypto.senderId(t.publicKey);this.messageProcessors={1:new M(n,this.crypto)},this.session.onMessage((e=>_(this,void 0,void 0,(function*(){this.log("Got message","payload"!==e.type?e:Object.assign(Object.assign({},e),{payload:e.payload.slice(0,this.maxPayloadLogLength)}));const n=this.messageProcessors[e.version];if(void 0===n)return;const r=yield n.processMessage(e,t);yield this.onAction(r)})))),this.session.onClose((()=>{setTimeout((()=>{this.connect(e)}),200)}));const r=this.messageProcessors[this.version];if(void 0===r)return;const s=yield r.init();yield this.onAction(s),yield function(e,t){return n=this,r=void 0,o=function*(){const n=new Promise(((t,n)=>{setTimeout((()=>{n(new Error("The execution timed out."))}),e)}));return yield Promise.race([t,n])},new((s=void 0)||(s=Promise))((function(e,t){function i(e){try{a(o.next(e))}catch(e){t(e)}}function c(e){try{a(o.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(i,c)}a((o=o.apply(n,r||[])).next())}));var n,r,s,o}(this.connectionTimeoutMillis,this.isConnected.promise).catch((()=>{throw new Error(`The connection with ${this.lastSelectedURL} could not be established.`)})),this.log("Connected")}))}send(e,t){return _(this,void 0,void 0,(function*(){const n=this.messageProcessors[this.version];if(void 0===n)return;const r=this.crypto.senderId(e),s=yield n.prepareMessage(r,t);yield this.session.send(s),this.log("Sent payload","Sent",this.maxPayloadLogLength>0?t.slice(0,this.maxPayloadLogLength):t,"to",e)}))}onMessage(e){this.messageListeners.push(e)}close(){return _(this,void 0,void 0,(function*(){this.messageListeners=[],yield this.session.close()}))}idFromPublicKey(e){return this.crypto.senderId(e)}onAction(e){return _(this,void 0,void 0,(function*(){switch(null==e?void 0:e.type){case"connected":this.onConnected(e);break;case"send":yield this.onSend(e);break;case"notify":this.onNotify(e)}}))}onConnected(e){this.isConnected.resolve()}onSend(e){return _(this,void 0,void 0,(function*(){yield this.session.send(e.message)}))}onNotify(e){this.messageListeners.forEach((t=>{t(e.message)}))}log(e,...t){this.enableLogging&&g(`[ACURAST-TRANSPORT-WEBSOCKET:${this.lastSelectedURL}] ${e}`,...t)}}var K=n(8287).hp,U=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((r=r.apply(e,t||[])).next())}))};class E extends m{get ws(){if(void 0===this._ws)throw new Error("WebSocket implementation not found");return this._ws}open(e){return U(this,void 0,void 0,(function*(){this._ws=new WebSocket(e),this.ws.binaryType="arraybuffer",yield new Promise(((e,t)=>{this.ws.onopen=()=>{this.ws.onerror=null,this.ws.onopen=null,e()},this.ws.onerror=e=>{this.ws.onerror=null,this.ws.onopen=null,t(e)}}))}))}close(){var e;return U(this,void 0,void 0,(function*(){this.ws.onclose=null,null===(e=this._ws)||void 0===e||e.close()}))}onRawMessage(e){this.ws.addEventListener("message",(t=>{e(K.from(t.data))}))}sendRaw(e){return U(this,void 0,void 0,(function*(){this.ws.send(e)}))}onClose(e){this.ws.onclose=()=>{this.ws.onopen=null,this.ws.onerror=null,e()}}}class T extends R{constructor(e,t,n=100,r=!1){super(e,t,new E,void 0,n,r)}}},7526:(e,t)=>{"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=c(e),i=o[0],a=o[1],u=new s(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),l=0,h=a>0?i-4:i;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[l++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,s=r%3,o=[],i=16383,c=0,u=r-s;c<u;c+=i)o.push(a(e,c,c+i>u?u:c+i));return 1===s?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===s&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)n[i]=o[i],r[o.charCodeAt(i)]=i;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function a(e,t,r){for(var s,o,i=[],c=t;c<r;c+=3)s=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(255&e[c+2]),i.push(n[(o=s)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return i.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},5037:(e,t,n)=>{var r;function s(e){this.rand=e}if(e.exports=function(e){return r||(r=new s(null)),r.generate(e)},e.exports.Rand=s,s.prototype.generate=function(e){return this._rand(e)},s.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),n=0;n<t.length;n++)t[n]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?s.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?s.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(s.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var o=n(3776);if("function"!=typeof o.randomBytes)throw new Error("Not supported");s.prototype._rand=function(e){return o.randomBytes(e)}}catch(e){}}}]);